# gecko_trace.calculate_signature

Calculates a signature hash for a trace based on its root span structure.

## Signature

```sql
gecko_trace.calculate_signature(rootSpan JSON) RETURNS STRING
```

## Arguments

- `rootSpan`: JSON object representing the root span of a trace tree, typically generated by `gecko_trace.build_root_span()`. Should contain:
  - `name`: Span name
  - `scope`: Object with `name` property
  - `resource`: Object with `attributes` property
  - `events`: Optional array of event objects with `name` and `attributes`
  - `childSpans`: Array of child span objects with the same structure

## Description

Uses a fast hash function (cyrb64) to generate a deterministic signature based on the hierarchical structure and attributes of spans in a trace. The signature is calculated by traversing the span tree depth-first and hashing:

- Resource attributes (excluding certain internal IDs like `gecko_process_internal_id`)
- Scope names
- Span names
- Event names and attributes

This allows grouping traces that have similar structure and content, which is useful for:
- Performance analysis and benchmarking
- Anomaly detection in trace patterns
- Identifying common execution paths
- Aggregating metrics across similar traces

## Returns

Returns a string hash that serves as a deterministic signature for the trace structure. Traces with identical signatures have the same execution pattern and can be grouped together for analysis.

## Example

```sql
WITH root_span AS (
  SELECT gecko_trace.build_root_span(spans_array) as root
  FROM traces_table
  WHERE trace_id = 'some_trace_id'
)
SELECT gecko_trace.calculate_signature(root) as signature
FROM root_span
```

## Hash Algorithm

Uses the cyrb64 hash function, which is:
- Fast and efficient for string hashing
- Provides good collision resistance for practical use cases
- Deterministic across different executions
- Based on MurmurHash principles

## Notes

- Signatures are deterministic - identical trace structures will always produce the same signature
- Internal process IDs and other volatile attributes are excluded from hashing to focus on logical execution patterns
- Used in conjunction with `gecko_trace.build_root_span()` for complete trace analysis workflows
- Returns empty string for NULL input
