friendly_name: Newtab Interactions Hourly
description: |-
  Interactions on Newtab desktop across all territories and release channels. The addition
  of the Unified API (UAPI) includes mobile data in addition to desktop.

  For any downstream jobs specific to desktop, filter on the surface column

  This job runs hourly and is aggregated by day, tile ID, and position.

  Anyone doing backfills on this model should be mindful that the legacy data currently has an
  expiration of 180 days.
owners:
- cbeck@mozilla.com
labels:
  incremental: true
  owner1: cbeck
  dag: bqetl_newtab_interactions_hourly
scheduling:
  dag_name: bqetl_newtab_interactions_hourly
  date_partition_parameter: null
  destination_table: newtab_interactions_hourly_v1${{ (execution_date - macros.timedelta(hours=1)).strftime("%Y%m%d")
    }}
  parameters:
  - submission_date:DATE:{{ (execution_date - macros.timedelta(hours=1)).strftime('%Y-%m-%d')
    }}
  query_file_path: sql/moz-fx-data-shared-prod/telemetry_derived/newtab_interactions_hourly_v1/query.sql
bigquery:
  time_partitioning:
    type: day
    field: submission_date
    require_partition_filter: true
    expiration_days: null
  range_partitioning: null
  clustering: null
workgroup_access:
- role: roles/bigquery.dataViewer
  members:
  - workgroup:mozilla-confidential
references:
  query.sql:
  - moz-fx-data-shared-prod.activity_stream_live.impression_stats_v1
  - moz-fx-data-shared-prod.ads_derived.interaction_aggregates_hourly_v1
  - moz-fx-data-shared-prod.firefox_desktop_live.newtab_v1
  - moz-fx-data-shared-prod.telemetry_derived.newtab_interactions_historical_legacy_v1
require_column_descriptions: false
