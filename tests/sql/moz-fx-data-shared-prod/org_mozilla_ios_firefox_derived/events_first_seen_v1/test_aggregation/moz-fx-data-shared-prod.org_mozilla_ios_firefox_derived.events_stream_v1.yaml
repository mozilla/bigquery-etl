---
# Test 1: New TOU with surface = "bottom_sheet" (not in history)
- client_id: client1-tou-new
  profile_group_id: "client1-tou-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "bottom_sheet", version: "1.0"}
  client_info:
    windows_build_number: null

# Test 2: New onboarding TOU (not in history)
- client_id: client2-onboarding-new
  profile_group_id: "client2-onboarding-profile"
  sample_id: 1
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T11:00:00
  event_timestamp: 2025-10-29T11:00:00
  event_extra: {screen: "welcome"}
  client_info:
    windows_build_number: null

# Test 3: TOU event already in history - EXCLUDED
- client_id: client3-existing
  profile_group_id: "client3-existing-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T12:00:00
  event_timestamp: 2025-10-29T12:00:00
  event_extra: {surface: "bottom_sheet", version: "2.0"}
  client_info:
    windows_build_number: null

# Test 4: TOU with surface = "modal" - EXCLUDED (wrong surface)
- client_id: client4-wrong-surface
  profile_group_id: "client4-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "modal", version: "1.0"}
  client_info:
    windows_build_number: null

# Test 5: TOU with no surface field - EXCLUDED
- client_id: client5-no-surface
  profile_group_id: "client5-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {version: "1.0"}
  client_info:
    windows_build_number: null

# Test 6: Multiple TOU events same day - aggregates to earliest
- client_id: client6-multiple
  profile_group_id: "client6-profile-1"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T08:00:00  # Earliest
  event_timestamp: 2025-10-29T08:00:00
  event_extra: {surface: "bottom_sheet", attempt: 1}
  client_info:
    windows_build_number: null
- client_id: client6-multiple
  profile_group_id: "client6-profile-2"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T14:00:00  # Later
  event_timestamp: 2025-10-29T14:00:00
  event_extra: {surface: "bottom_sheet", attempt: 2}
  client_info:
    windows_build_number: null

# Test 7: Same client, both TOU event types (both new)
- client_id: client7-both-types
  profile_group_id: "client7-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "bottom_sheet", type: "tou"}
  client_info:
    windows_build_number: null
- client_id: client7-both-types
  profile_group_id: "client7-profile"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T11:00:00
  event_timestamp: 2025-10-29T11:00:00
  event_extra: {type: "onboarding"}
  client_info:
    windows_build_number: null

# Test 8: Same client, one event in history, one new
- client_id: client8-partial-history
  profile_group_id: "client8-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "bottom_sheet", type: "old"}
  client_info:
    windows_build_number: null
- client_id: client8-partial-history
  profile_group_id: "client8-profile"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T11:00:00
  event_timestamp: 2025-10-29T11:00:00
  event_extra: {type: "new"}
  client_info:
    windows_build_number: null

# Test 9: TOU declined - EXCLUDED (wrong event_name)
- client_id: client9-tou-declined
  profile_group_id: "client9-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "declined"
  event: "terms_of_use#declined"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "bottom_sheet"}
  client_info:
    windows_build_number: null

# Test 10: Onboarding started - EXCLUDED (wrong event_name)
- client_id: client10-onboarding-started
  profile_group_id: "client10-profile"
  sample_id: 0
  event_category: "onboarding"
  event_name: "started"
  event: "onboarding#started"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {}
  client_info:
    windows_build_number: null

# Test 11: Wrong category - EXCLUDED
- client_id: client11-wrong-category
  profile_group_id: "client11-profile"
  sample_id: 0
  event_category: "privacy"
  event_name: "accepted"
  event: "privacy#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {}
  client_info:
    windows_build_number: null

# Test 12: Excluded event category (media.playback)
- client_id: client12-excluded-media
  profile_group_id: "client12-profile"
  sample_id: 0
  event_category: "media.playback"
  event_name: "accepted"
  event: "media.playback#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {}
  client_info:
    windows_build_number: null

# Test 13: Wrong date - EXCLUDED (DATE != @submission_date)
- client_id: client13-wrong-date
  profile_group_id: "client13-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-28T10:00:00
  event_timestamp: 2025-10-28T10:00:00
  event_extra: {surface: "bottom_sheet"}
  client_info:
    windows_build_number: null

# Test 14: NULL optional fields
- client_id: client14-nulls
  profile_group_id: "client14-profile"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: null
  event_extra: {screen: "setup"}
  normalized_channel: null
  normalized_country_code: null
  normalized_os: null
  normalized_os_version: null
  client_info:
    windows_build_number: null

# Test 15: event_extra is null (TOU) - EXCLUDED (can't check surface)
- client_id: client15-null-extra
  profile_group_id: "client15-profile"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: null
  client_info:
    windows_build_number: null

# Test 16: Onboarding with various surface values (surface not checked)
- client_id: client16-onboarding-surfaces
  profile_group_id: "client16-profile"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00
  event_extra: {surface: "modal", screen: "welcome"}
  client_info:
    windows_build_number: null

# Test 17: ARRAY_AGG ordering - same submission, different event_timestamp
- client_id: client17-event-ordering
  profile_group_id: "client17-profile-1"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T09:00:00  # Earlier (should be picked)
  event_extra: {surface: "bottom_sheet", order: 1}
  client_info:
    windows_build_number: null
- client_id: client17-event-ordering
  profile_group_id: "client17-profile-2"
  sample_id: 0
  event_category: "terms_of_use"
  event_name: "accepted"
  event: "terms_of_use#accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T10:00:00  # Later
  event_extra: {surface: "bottom_sheet", order: 2}
  client_info:
    windows_build_number: null

# Test 18: NULL event_timestamp with COALESCE ordering
- client_id: client18-null-timestamp
  profile_group_id: "client18-profile-1"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: 2025-10-29T09:00:00  # Has timestamp (should be picked)
  event_extra: {has_timestamp: true}
  client_info:
    windows_build_number: null
- client_id: client18-null-timestamp
  profile_group_id: "client18-profile-2"
  sample_id: 0
  event_category: "onboarding"
  event_name: "terms_of_service_accepted"
  event: "onboarding#terms_of_service_accepted"
  submission_timestamp: 2025-10-29T10:00:00
  event_timestamp: null  # NULL sorted last
  event_extra: {has_timestamp: false}
  client_info:
    windows_build_number: null
