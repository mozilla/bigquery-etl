#!/bin/bash

set -e

# Absolute path this script is in
SCRIPT_PATH="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
CMD=$1

if [ "$PWD" != "$SCRIPT_PATH" ]; then
    echo "Please run this command from the root of your bigquery-etl checkout ($SCRIPT_PATH)"
    exit 1
fi

if ! command -v python3 &> /dev/null; then
    echo "Please install python (version 3.8 or greater)"
    exit 1
fi

if [ "$CMD" == "bootstrap" ]; then
    if [[ "$2" == "--with-java" ]]; then
      mvn package
    fi
    poetry install
    echo "bqetl configured! It should now be ready for use."
    exit 0
fi

export CLOUDSDK_PYTHON=$(which python)
poetry run bqetl "$@"
