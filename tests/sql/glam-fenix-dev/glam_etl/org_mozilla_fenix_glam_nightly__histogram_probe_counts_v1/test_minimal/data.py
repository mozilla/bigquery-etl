import yaml
from pathlib import Path

ROOT = Path(__file__).parent

UUID = "df735f02-efe5-4b07-b212-583bb99ba241"
SUBMISSION_DATE = "2020-10-01"
APP_BUILD_ID = "2020100100"

# NOTE: what happens when channel = "*"?
HISTOGRAM_BUCKET_COUNTS = [
    {
        "agg_type": "summed_histogram",
        "app_build_id": "*",
        "app_version": 84,
        "channel": "*",
        "key": "",
        "metric": "network_tcp_connection",
        "metric_type": "timing_distribution",
        "os": "*",
        "ping_type": "*",
        "range_max": 123078199,
        "record": {"key": "112863206", "value": 1.0},
    },
    {
        "agg_type": "summed_histogram",
        "app_build_id": "*",
        "app_version": 84,
        "channel": "*",
        "key": "",
        "metric": "network_tcp_connection",
        "metric_type": "timing_distribution",
        "os": "*",
        "ping_type": "*",
        "range_max": 123078199,
        "record": {"key": "123078199", "value": 0.0},
    },
]

EXPECT = [
    {
        "agg_type": "histogram",
        "aggregates": [
            {"key": "0", "value": 0.002512562814070352},
            {"key": "1", "value": 0.002512562814070352},
            {"key": "2", "value": 0.002512562814070352},
            {"key": "3", "value": 0.002512562814070352},
            {"key": "4", "value": 0.002512562814070352},
            {"key": "5", "value": 0.002512562814070352},
            {"key": "6", "value": 0.002512562814070352},
            {"key": "7", "value": 0.002512562814070352},
            {"key": "8", "value": 0.002512562814070352},
            {"key": "9", "value": 0.002512562814070352},
            {"key": "10", "value": 0.002512562814070352},
            {"key": "11", "value": 0.002512562814070352},
            {"key": "12", "value": 0.002512562814070352},
            {"key": "13", "value": 0.002512562814070352},
            {"key": "14", "value": 0.002512562814070352},
            {"key": "16", "value": 0.002512562814070352},
            {"key": "17", "value": 0.002512562814070352},
            {"key": "19", "value": 0.002512562814070352},
            {"key": "20", "value": 0.002512562814070352},
            {"key": "22", "value": 0.002512562814070352},
            {"key": "24", "value": 0.002512562814070352},
            {"key": "26", "value": 0.002512562814070352},
            {"key": "29", "value": 0.002512562814070352},
            {"key": "32", "value": 0.002512562814070352},
            {"key": "34", "value": 0.002512562814070352},
            {"key": "38", "value": 0.002512562814070352},
            {"key": "41", "value": 0.002512562814070352},
            {"key": "45", "value": 0.002512562814070352},
            {"key": "49", "value": 0.002512562814070352},
            {"key": "53", "value": 0.002512562814070352},
            {"key": "58", "value": 0.002512562814070352},
            {"key": "64", "value": 0.002512562814070352},
            {"key": "69", "value": 0.002512562814070352},
            {"key": "76", "value": 0.002512562814070352},
            {"key": "82", "value": 0.002512562814070352},
            {"key": "90", "value": 0.002512562814070352},
            {"key": "98", "value": 0.002512562814070352},
            {"key": "107", "value": 0.002512562814070352},
            {"key": "117", "value": 0.002512562814070352},
            {"key": "128", "value": 0.002512562814070352},
            {"key": "139", "value": 0.002512562814070352},
            {"key": "152", "value": 0.002512562814070352},
            {"key": "165", "value": 0.002512562814070352},
            {"key": "181", "value": 0.002512562814070352},
            {"key": "197", "value": 0.002512562814070352},
            {"key": "215", "value": 0.002512562814070352},
            {"key": "234", "value": 0.002512562814070352},
            {"key": "256", "value": 0.002512562814070352},
            {"key": "279", "value": 0.002512562814070352},
            {"key": "304", "value": 0.002512562814070352},
            {"key": "331", "value": 0.002512562814070352},
            {"key": "362", "value": 0.002512562814070352},
            {"key": "394", "value": 0.002512562814070352},
            {"key": "430", "value": 0.002512562814070352},
            {"key": "469", "value": 0.002512562814070352},
            {"key": "512", "value": 0.002512562814070352},
            {"key": "558", "value": 0.002512562814070352},
            {"key": "608", "value": 0.002512562814070352},
            {"key": "663", "value": 0.002512562814070352},
            {"key": "724", "value": 0.002512562814070352},
            {"key": "789", "value": 0.002512562814070352},
            {"key": "861", "value": 0.002512562814070352},
            {"key": "939", "value": 0.002512562814070352},
            {"key": "1024", "value": 0.002512562814070352},
            {"key": "1116", "value": 0.002512562814070352},
            {"key": "1217", "value": 0.002512562814070352},
            {"key": "1327", "value": 0.002512562814070352},
            {"key": "1448", "value": 0.002512562814070352},
            {"key": "1579", "value": 0.002512562814070352},
            {"key": "1722", "value": 0.002512562814070352},
            {"key": "1878", "value": 0.002512562814070352},
            {"key": "2048", "value": 0.002512562814070352},
            {"key": "2233", "value": 0.002512562814070352},
            {"key": "2435", "value": 0.002512562814070352},
            {"key": "2655", "value": 0.002512562814070352},
            {"key": "2896", "value": 0.002512562814070352},
            {"key": "3158", "value": 0.002512562814070352},
            {"key": "3444", "value": 0.002512562814070352},
            {"key": "3756", "value": 0.002512562814070352},
            {"key": "4096", "value": 0.002512562814070352},
            {"key": "4466", "value": 0.002512562814070352},
            {"key": "4870", "value": 0.002512562814070352},
            {"key": "5311", "value": 0.002512562814070352},
            {"key": "5792", "value": 0.002512562814070352},
            {"key": "6316", "value": 0.002512562814070352},
            {"key": "6888", "value": 0.002512562814070352},
            {"key": "7512", "value": 0.002512562814070352},
            {"key": "8192", "value": 0.002512562814070352},
            {"key": "8933", "value": 0.002512562814070352},
            {"key": "9741", "value": 0.002512562814070352},
            {"key": "10623", "value": 0.002512562814070352},
            {"key": "11585", "value": 0.002512562814070352},
            {"key": "12633", "value": 0.002512562814070352},
            {"key": "13777", "value": 0.002512562814070352},
            {"key": "15024", "value": 0.002512562814070352},
            {"key": "16384", "value": 0.002512562814070352},
            {"key": "17866", "value": 0.002512562814070352},
            {"key": "19483", "value": 0.002512562814070352},
            {"key": "21247", "value": 0.002512562814070352},
            {"key": "23170", "value": 0.002512562814070352},
            {"key": "25267", "value": 0.002512562814070352},
            {"key": "27554", "value": 0.002512562814070352},
            {"key": "30048", "value": 0.002512562814070352},
            {"key": "32768", "value": 0.002512562814070352},
            {"key": "35733", "value": 0.002512562814070352},
            {"key": "38967", "value": 0.002512562814070352},
            {"key": "42494", "value": 0.002512562814070352},
            {"key": "46340", "value": 0.002512562814070352},
            {"key": "50535", "value": 0.002512562814070352},
            {"key": "55108", "value": 0.002512562814070352},
            {"key": "60096", "value": 0.002512562814070352},
            {"key": "65536", "value": 0.002512562814070352},
            {"key": "71467", "value": 0.002512562814070352},
            {"key": "77935", "value": 0.002512562814070352},
            {"key": "84989", "value": 0.002512562814070352},
            {"key": "92681", "value": 0.002512562814070352},
            {"key": "101070", "value": 0.002512562814070352},
            {"key": "110217", "value": 0.002512562814070352},
            {"key": "120193", "value": 0.002512562814070352},
            {"key": "131072", "value": 0.002512562814070352},
            {"key": "142935", "value": 0.002512562814070352},
            {"key": "155871", "value": 0.002512562814070352},
            {"key": "169979", "value": 0.002512562814070352},
            {"key": "185363", "value": 0.002512562814070352},
            {"key": "202140", "value": 0.002512562814070352},
            {"key": "220435", "value": 0.002512562814070352},
            {"key": "240387", "value": 0.002512562814070352},
            {"key": "262144", "value": 0.002512562814070352},
            {"key": "285870", "value": 0.002512562814070352},
            {"key": "311743", "value": 0.002512562814070352},
            {"key": "339958", "value": 0.002512562814070352},
            {"key": "370727", "value": 0.002512562814070352},
            {"key": "404281", "value": 0.002512562814070352},
            {"key": "440871", "value": 0.002512562814070352},
            {"key": "480774", "value": 0.002512562814070352},
            {"key": "524288", "value": 0.002512562814070352},
            {"key": "571740", "value": 0.002512562814070352},
            {"key": "623487", "value": 0.002512562814070352},
            {"key": "679917", "value": 0.002512562814070352},
            {"key": "741455", "value": 0.002512562814070352},
            {"key": "808562", "value": 0.002512562814070352},
            {"key": "881743", "value": 0.002512562814070352},
            {"key": "961548", "value": 0.002512562814070352},
            {"key": "1048576", "value": 0.002512562814070352},
            {"key": "1143480", "value": 0.002512562814070352},
            {"key": "1246974", "value": 0.002512562814070352},
            {"key": "1359834", "value": 0.002512562814070352},
            {"key": "1482910", "value": 0.002512562814070352},
            {"key": "1617125", "value": 0.002512562814070352},
            {"key": "1763487", "value": 0.002512562814070352},
            {"key": "1923096", "value": 0.002512562814070352},
            {"key": "2097152", "value": 0.002512562814070352},
            {"key": "2286960", "value": 0.002512562814070352},
            {"key": "2493948", "value": 0.002512562814070352},
            {"key": "2719669", "value": 0.002512562814070352},
            {"key": "2965820", "value": 0.002512562814070352},
            {"key": "3234250", "value": 0.002512562814070352},
            {"key": "3526975", "value": 0.002512562814070352},
            {"key": "3846193", "value": 0.002512562814070352},
            {"key": "4194304", "value": 0.002512562814070352},
            {"key": "4573920", "value": 0.002512562814070352},
            {"key": "4987896", "value": 0.002512562814070352},
            {"key": "5439339", "value": 0.002512562814070352},
            {"key": "5931641", "value": 0.002512562814070352},
            {"key": "6468501", "value": 0.002512562814070352},
            {"key": "7053950", "value": 0.002512562814070352},
            {"key": "7692387", "value": 0.002512562814070352},
            {"key": "8388608", "value": 0.002512562814070352},
            {"key": "9147841", "value": 0.002512562814070352},
            {"key": "9975792", "value": 0.002512562814070352},
            {"key": "10878678", "value": 0.002512562814070352},
            {"key": "11863283", "value": 0.002512562814070352},
            {"key": "12937002", "value": 0.002512562814070352},
            {"key": "14107900", "value": 0.002512562814070352},
            {"key": "15384774", "value": 0.002512562814070352},
            {"key": "16777216", "value": 0.002512562814070352},
            {"key": "18295683", "value": 0.002512562814070352},
            {"key": "19951584", "value": 0.002512562814070352},
            {"key": "21757357", "value": 0.002512562814070352},
            {"key": "23726566", "value": 0.002512562814070352},
            {"key": "25874004", "value": 0.002512562814070352},
            {"key": "28215801", "value": 0.002512562814070352},
            {"key": "30769549", "value": 0.002512562814070352},
            {"key": "33554432", "value": 0.002512562814070352},
            {"key": "36591367", "value": 0.002512562814070352},
            {"key": "39903169", "value": 0.002512562814070352},
            {"key": "43514714", "value": 0.002512562814070352},
            {"key": "47453132", "value": 0.002512562814070352},
            {"key": "51748008", "value": 0.002512562814070352},
            {"key": "56431603", "value": 0.002512562814070352},
            {"key": "61539099", "value": 0.002512562814070352},
            {"key": "67108864", "value": 0.002512562814070352},
            {"key": "73182735", "value": 0.002512562814070352},
            {"key": "79806338", "value": 0.002512562814070352},
            {"key": "87029429", "value": 0.002512562814070352},
            {"key": "94906265", "value": 0.002512562814070352},
            {"key": "103496016", "value": 0.002512562814070352},
            {"key": "112863206", "value": 0.5025125628140703},
            {"key": "123078199", "value": 0.002512562814070352},
        ],
        "app_build_id": "*",
        "app_version": 84,
        "channel": "*",
        "client_agg_type": "summed_histogram",
        "key": "",
        "metric": "network_tcp_connection",
        "metric_type": "timing_distribution",
        "os": "*",
        "ping_type": "*",
        "total_users": 1,
    }
]

prefix = "glam_etl"
tables = [
    (
        f"{prefix}.org_mozilla_fenix_glam_nightly__histogram_bucket_counts_v1.yaml",
        HISTOGRAM_BUCKET_COUNTS,
    ),
    ("expect.yaml", EXPECT),
]
for name, data in tables:
    with (ROOT / name).open("w") as fp:
        yaml.dump(data, fp)
