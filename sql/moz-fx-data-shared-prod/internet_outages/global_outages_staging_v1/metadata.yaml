friendly_name: Internet Outages Staging
# yamllint disable rule:line-length
description: |-
  Intermediate table to support the final clustered global_outages_v1 table.

  This intermediate table is not partitioned, since partitioning seems to be part
  of the performance regression that is causing the query to otherwise fail as
  too complex. It's somewhat brittle that this table is not partitioned; each
  invocation will completely replace the table contents, so concurrent runs will
  cause a race condition. This is somewhat mitigated by the fact that if there's
  a mismatch between the data in the table and the subsequent job that reads this
  table, an error will be thrown because the timestamp info falls outside of the
  allowed values for the destination partition.
owners:
- aplacitelli@mozilla.com
labels:
  incremental: true
  review_bugs:
  - '1640204'
scheduling:
  dag_name: bqetl_internet_outages
  # destination is the whole table, not a single partition,
  # so don't use date_partition_parameter
  date_partition_parameter: null
  parameters: ["date:DATE:{{ds}}"]
  # provide this value so that DAG generation does not have to dry run the
  # query to get it, and that would be slow because main_v4 is referenced
  referenced_tables:
  - - moz-fx-data-shared-prod
    - telemetry_stable
    - main_v4
  - - moz-fx-data-shared-prod
    - telemetry_derived
    - clients_daily_v6
  - - moz-fx-data-shared-prod
    - telemetry_stable
    - health_v4
bigquery:
  clustering:
    fields:
    - country
    - city

# Generated by bigquery_etl.dependency
references:
  query.sql:
  - telemetry.clients_daily
  - telemetry.health
  - telemetry_stable.main_v4
