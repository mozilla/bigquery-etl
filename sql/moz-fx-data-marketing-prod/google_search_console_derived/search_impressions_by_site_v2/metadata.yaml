friendly_name: Search Impressions By Site
description: |-
  Google Search impressions aggregated by site, exported directly to BigQuery for the following domains:
    * addons.mozilla.org
    * blog.mozilla.org
    * getpocket.com
    * support.mozilla.org
    * www.mozilla.org

  Anonymized search queries are included.

  We started exporting Google Search Console data directly to BigQuery in July 2023.
  See https://bugzilla.mozilla.org/show_bug.cgi?id=1764960#c34.
owners:
- srose@mozilla.com
labels:
  incremental: true
  owner1: srose
scheduling:
  dag_name: bqetl_google_search_console
  date_partition_parameter: date
  # Google Search Console exports typically happen two days after the data date in UTC.
  date_partition_offset: -1
  depends_on_table_partitions_existing:
  - task_id: wait_for_google_search_console_addons_site_impressions
    table_id: moz-fx-data-marketing-prod.searchconsole_addons.searchdata_site_impression
    partition_id: '{{ macros.ds_add(ds, -1) | ds_nodash }}'
  - task_id: wait_for_google_search_console_blog_site_impressions
    table_id: moz-fx-data-marketing-prod.searchconsole_blog.searchdata_site_impression
    partition_id: '{{ macros.ds_add(ds, -1) | ds_nodash }}'
  - task_id: wait_for_google_search_console_getpocket_site_impressions
    table_id: moz-fx-data-marketing-prod.searchconsole_getpocket.searchdata_site_impression
    partition_id: '{{ macros.ds_add(ds, -1) | ds_nodash }}'
  - task_id: wait_for_google_search_console_support_site_impressions
    table_id: moz-fx-data-marketing-prod.searchconsole_support.searchdata_site_impression
    partition_id: '{{ macros.ds_add(ds, -1) | ds_nodash }}'
  - task_id: wait_for_google_search_console_www_site_impressions
    table_id: moz-fx-data-marketing-prod.searchconsole_www.searchdata_site_impression
    partition_id: '{{ macros.ds_add(ds, -1) | ds_nodash }}'
bigquery:
  time_partitioning:
    type: day
    field: date
    require_partition_filter: false
    expiration_days: null
  clustering:
    fields:
    - site_domain_name

# Generated by bigquery_etl.dependency
references:
  query.sql:
  - moz-fx-data-marketing-prod.searchconsole_addons.searchdata_site_impression
  - moz-fx-data-marketing-prod.searchconsole_blog.searchdata_site_impression
  - moz-fx-data-marketing-prod.searchconsole_getpocket.searchdata_site_impression
  - moz-fx-data-marketing-prod.searchconsole_support.searchdata_site_impression
  - moz-fx-data-marketing-prod.searchconsole_www.searchdata_site_impression
