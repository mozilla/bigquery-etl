friendly_name: ASN Aggregates
description: >-
  A daily aggregate of clients per ASN (Autonomous System Number) and 
  DoH (DNS over HTTPS) usage, partitioned by day. Only ASNs with more 
  than a critical threshold of clients are considered.
owners:
  - tdsmith@mozilla.com
  - ascholtz@mozilla.com
labels:
  incremental: true
  schedule: daily
scheduling:
  dag_name: bqetl_asn_aggregates
  parameters: ["n_clients:INT64:500"]
  referenced_tables:
  - ['static', 'isp_blocks_ipv4_20200407']
  - ['telemetry_derived', 'events_v1']
  - ['telemetry_derived', 'main_events_v1']
  - ['telemetry_derived', 'events_events_v1']
  - ['payload_bytes_raw', 'telemetry']
  depends_on:
    - dag_name: copy_deduplicate
      task_id: event_events
      exectuion_delta: 1h
    - dag_name: copy_deduplicate
      task_id: bq_main_events
      exectuion_delta: 1h
