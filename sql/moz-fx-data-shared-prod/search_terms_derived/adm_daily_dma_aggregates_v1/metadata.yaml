friendly_name: adMarketplace Daily Aggregation with DMA
description: |-
  Daily summary for adMarketplace of Firefox Suggest impressions and clicks
  per search term and DMA (Designated Market Area)

  The sending to adMarketplace takes place in a separate DAG defined in
  the telemetry-airflow repository directly.

  Note: This table processes data from 2 days ago, ensuring complete upstream data
  from the Merino sanitization job (~16 hours).
  This is a temporary measure until the sanitization job is further optimized.
owners:
- llisi@mozilla.com
labels:
  dag: bqetl_search_terms_daily
  owner1: llisi
scheduling:
  dag_name: bqetl_search_terms_daily
  arguments:
  - --schema_update_option=ALLOW_FIELD_ADDITION
  date_partition_offset: -1
bigquery:
  time_partitioning:
    type: day
    field: submission_date
    require_partition_filter: true
    expiration_days: null
workgroup_access:
- role: roles/bigquery.dataViewer
  members:
  - workgroup:search-terms/aggregated
- role: roles/bigquery.metadataViewer
  members:
  - workgroup:search-terms/external-outerbounds-task-search-terms-sanitized
  - workgroup:search-terms/sanitized-writer
references:
  query.sql:
  - moz-fx-data-shared-prod.search_terms_derived.merino_log_sanitized_v3
  - moz-fx-data-shared-prod.search_terms_derived.suggest_impression_sanitized_v3
