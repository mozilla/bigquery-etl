# Usage Reporting

Generator responsible for generating queries and views to prepare the usage_reporting ping data for analytics purposes. To a large extent, the pipeline generated by this is very similar to that of baseline_clients_daily, last_seen, first_seen created by the `glean_usage` generator. This is in order to maintain a level of consistency across the two data sources and enable comparisons across the two.

---

On mobile, each channel will have a different app_id associated with it (different application as far as the app store is concerned). For each application id in a channel the following resources will get generated inside the correspond app_id namespace:

- usage_reporting_clients_daily_v1 - query.sql, metadata.yaml and schema.yaml
- usage_reporting_clients_first_seen_v1 - query.sql, metadata.yaml and schema.yaml
- usage_reporting_clients_last_seen_v1 - query.sql, metadata.yaml and schema.yaml

Additionally, a user facing namespace will be created for each and an application level namespace combining all configured channels that can be accessed via a single view.

---

On desktop this is slightly different as there is only a single application through which all channels flow. This will result in all listed artifacts being created in the application namespace and no union view being generated (since there is no need).

## Configuration

bqetl_project.yaml config file is used to determine for which applications and specific channels the generation artifacts should be created for. This app and channel list is specified under `generate`, `usage_reporting`, `apps` configuration. Here's an example of a valid configuration for this generator:

```yaml
generate:
  [...]
  usage_reporting:
    apps:
      fenix:
        channels:
        - nightly
        - beta
        - release
      firefox_ios:
        channels:
        - nightly
      firefox_desktop:
        # firefox_desktop is a single app containing multiple channels
        channels: null
```

## Running the generator

The following command can be used in the roor directory of the project to run the generator:

```bash
./bqetl generate usage_reporting
```

Additional options exist, those can be found using the following command:

```bash
./bqetl generate usage_reporting --help
```